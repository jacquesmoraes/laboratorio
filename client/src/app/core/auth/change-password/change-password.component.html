<div class="change-password-container">
  <mat-card class="change-password-card">
    <mat-card-header>
      <mat-card-title>Alterar Senha</mat-card-title>
      <mat-card-subtitle>Digite sua senha atual e a nova senha</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form (ngSubmit)="onSubmit()" class="change-password-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Senha Atual</mat-label>
          <input matInput type="password" [(ngModel)]="formData().currentPassword" name="currentPassword" required
            [disabled]="loading()" placeholder="Digite sua senha atual" />
          <mat-icon matSuffix>lock</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nova Senha</mat-label>
          <input matInput type="password" [(ngModel)]="formData().newPassword" name="newPassword" required
            [disabled]="loading()" placeholder="Digite a nova senha" />
          <mat-icon matSuffix>lock_reset</mat-icon>
        </mat-form-field>

        <!-- Adicionar o validador de senha aqui -->
        <app-password-strength-validator 
          [password]="formData().newPassword" #pwdVal>
        </app-password-strength-validator>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmar Nova Senha</mat-label>
          <input matInput type="password" [(ngModel)]="formData().confirmNewPassword" name="confirmNewPassword" required
            [disabled]="loading()" placeholder="Confirme a nova senha" />
          <mat-icon matSuffix>lock_reset</mat-icon>
        </mat-form-field>

        @if (error()) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>{{ error() }}</span>
        </div>
        }

        <div class="form-actions">
          <button mat-stroked-button type="button" (click)="goBack()" [disabled]="loading()" class="cancel-btn">
            <mat-icon>arrow_back</mat-icon>
            <span>Cancelar</span>
          </button>

          <button mat-raised-button color="primary" type="submit"
            [disabled]="loading() || !formData().currentPassword || !formData().newPassword || !formData().confirmNewPassword || !pwdVal.isValid"
            class="submit-btn">
            @if (loading()) {
            <mat-spinner diameter="20"></mat-spinner>
            <span>Alterando...</span>
            } @else {
            <ng-container>
              <mat-icon>save</mat-icon>
              <span>Alterar Senha</span>
            </ng-container>

            }
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
