<div class="reset-password-container">
  <mat-card class="reset-password-card">
    <mat-card-header>
      <mat-card-title>Redefinir Senha</mat-card-title>
      <mat-card-subtitle>Digite sua nova senha</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form (ngSubmit)="onSubmit()" class="reset-password-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input 
            matInput 
            type="email" 
            [ngModel]="email()" 
            (ngModelChange)="email.set($event)"
            name="email" 
            required 
            readonly 
            placeholder="seu@email.com" 
          />
          <mat-icon matSuffix>email</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nova Senha</mat-label>
          <input 
            matInput 
            type="password" 
            [ngModel]="newPassword()" 
            (ngModelChange)="newPassword.set($event)"
            name="newPassword" 
            required 
            [disabled]="loading()"
            placeholder="Digite sua nova senha" 
          />
          <mat-icon matSuffix>lock</mat-icon>
        </mat-form-field>

        <!-- Adicionar o validador de senha aqui -->
        <app-password-strength-validator 
          [password]="newPassword()" #pwdVal>
        </app-password-strength-validator>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmar Nova Senha</mat-label>
          <input 
            matInput 
            type="password" 
            [ngModel]="confirmPassword()" 
            (ngModelChange)="confirmPassword.set($event)"
            name="confirmPassword" 
            required
            [disabled]="loading()" 
            placeholder="Confirme sua nova senha" 
          />
          <mat-icon matSuffix>lock_outline</mat-icon>
        </mat-form-field>

        @if (error()) {
          <div class="error-message">
            <mat-icon>error</mat-icon>
            <span>{{ error() }}</span>
          </div>
        }

        @if (success()) {
          <div class="success-message">
            <mat-icon>check_circle</mat-icon>
            <span>{{ success() }}</span>
            <p class="redirect-text">Redirecionando para o login...</p>
          </div>
        }

        <button 
          mat-raised-button 
          color="primary" 
          type="submit" 
          class="full-width"
          [disabled]="loading() || !newPassword() || !confirmPassword() || !pwdVal.isValid"
        >
          @if (loading()) {
            <mat-spinner diameter="20"></mat-spinner>
            <span>Redefinindo...</span>
          } @else {
            <ng-container>
              <mat-icon>save</mat-icon>
              <span>Redefinir Senha</span>
            </ng-container>
          }
        </button>

        <button 
          mat-button 
          type="button" 
          class="full-width back-button" 
          (click)="goToLogin()"
          [disabled]="loading()"
        >
          <mat-icon>arrow_back</mat-icon>
          <span>Voltar ao Login</span>
        </button>
      </form>
    </mat-card-content>
  </mat-card>
</div>
